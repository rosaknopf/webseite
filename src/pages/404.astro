---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const posts = await getCollection("blog");
const latestPost = posts
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())[0];
---

<Layout
    title="Seite nicht gefunden (404)"
    description="Oops! Die gesuchte Seite existiert nicht."
>
    <section class="max-w-4xl mx-auto py-20 px-4 text-center">
        <h1 class="text-6xl md:text-8xl font-serif text-rose-950 mb-6">404</h1>
        <h2 class="text-2xl md:text-3xl font-bold text-rose-800 mb-6">
            Oops! Da haben wir wohl den Faden verloren.
        </h2>
        <p class="text-gray-600 mb-12 max-w-lg mx-auto text-lg">
            Die Seite, die Sie suchen, gibt es leider nicht (mehr). Vielleicht
            wurde sie verschoben oder der Link ist kaputt.
        </p>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mb-20">
            <a
                href="/"
                class="px-8 py-4 bg-rose-600 text-white rounded-xl font-bold hover:bg-rose-700 transition shadow-md"
            >
                Zurück zur Startseite
            </a>
            <a
                href="/products"
                class="px-8 py-4 bg-white text-rose-800 border-2 border-rose-200 rounded-xl font-bold hover:bg-rose-50 transition shadow-sm"
            >
                Im Shop stöbern
            </a>
        </div>

        {
            latestPost && (
                <div class="max-w-2xl mx-auto text-left">
                    <h3 class="font-serif text-2xl text-rose-950 mb-6 text-center">
                        Schauen Sie sich unseren neuesten Beitrag an:
                    </h3>
                    <a
                        href={`/blog/${latestPost.slug}/`}
                        class="group block bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition border border-rose-100 flex flex-col sm:flex-row"
                    >
                        <div class="sm:w-1/3 aspect-video sm:aspect-auto overflow-hidden bg-rose-50">
                            {latestPost.data.heroImage && (
                                <Image
                                    src={latestPost.data.heroImage}
                                    alt={latestPost.data.title}
                                    class="w-full h-full object-cover transform group-hover:scale-105 transition duration-500"
                                    width={400}
                                    densities={[1.5, 2]}
                                />
                            )}
                        </div>
                        <div class="p-6 sm:w-2/3 flex flex-col justify-center">
                            <h4 class="text-xl font-serif font-bold text-rose-900 mb-2 group-hover:text-rose-600 transition line-clamp-2">
                                {latestPost.data.title}
                            </h4>
                            <p class="text-rose-700/80 text-sm line-clamp-2 mb-4">
                                {latestPost.data.description}
                            </p>
                            <span class="text-rose-600 text-sm font-medium group-hover:underline flex items-center gap-1">
                                Beitrag lesen <span aria-hidden="true">&rarr;</span>
                            </span>
                        </div>
                    </a>
                </div>
            )
        }
    </section>
</Layout>
