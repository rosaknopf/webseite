---
import Layout from "../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { siteConfig } from "../../data/siteConfig";

const posts: CollectionEntry<"blog">[] = (await getCollection("blog"))
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout
    title={`Blog | ${siteConfig.title}`}
    description="Neuigkeiten, Geschichten und Updates aus unserer Manufaktur."
>
    <section class="max-w-6xl mx-auto py-12">
        <h1
            class="text-4xl md:text-5xl font-serif text-center text-rose-950 mb-4"
        >
            Unser Blog
        </h1>
        <p class="text-center text-rose-700/80 mb-16 max-w-2xl mx-auto">
            Einblicke hinter die Kulissen, Anleitungen und Geschichten rund um
            unsere handgemachten Projekte.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {
                posts.map((post) => (
                    <a
                        href={`/blog/${post.slug}/`}
                        class="group block bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition border border-rose-50 h-full flex flex-col"
                    >
                        <div class="aspect-[16/10] overflow-hidden bg-rose-100">
                            {post.data.heroImage ? (
                                <Image
                                    src={post.data.heroImage}
                                    alt={post.data.title}
                                    class="w-full h-full object-cover transform group-hover:scale-105 transition duration-500"
                                    width={720}
                                    densities={[1.5, 2]}
                                />
                            ) : (
                                <div class="w-full h-full flex items-center justify-center text-rose-300 bg-rose-50">
                                    <span class="text-4xl opacity-20">✏️</span>
                                </div>
                            )}
                        </div>
                        <div class="p-6 flex-grow flex flex-col">
                            <div class="text-xs text-rose-400 font-medium mb-2 uppercase tracking-wide">
                                {post.data.pubDate.toLocaleDateString("de-DE")}
                            </div>
                            <h2 class="text-xl font-serif font-bold text-rose-900 mb-2 group-hover:text-rose-600 transition">
                                {post.data.title}
                            </h2>
                            <p class="text-rose-700/80 text-sm line-clamp-3 mb-4 flex-grow">
                                {post.data.description}
                            </p>
                            <span class="text-rose-600 text-sm font-medium group-hover:underline">
                                Weiterlesen →
                            </span>
                        </div>
                    </a>
                ))
            }
        </div>
    </section>
</Layout>
